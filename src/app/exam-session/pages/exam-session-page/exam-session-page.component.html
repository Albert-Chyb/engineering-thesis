<ng-template #loadingTemplate>
  <app-loading-indicator> Ładuję test ... </app-loading-indicator>
</ng-template>

<ng-template #noDataTemplate></ng-template>

<ng-template #dataTemplate>
  <mat-card class="with-spacing-fix">
    <mat-card-header>
      <h1 mat-card-title>Rozwiąż test</h1>
      <p mat-card-subtitle>Nazwa testu: {{ metadata()?.name }}</p>
    </mat-card-header>
    <mat-card-content>
      <form
        class="v-stack"
        id="solved-test-form"
        [formGroup]="form"
        (ngSubmit)="handleFormSubmit()"
      >
        <app-test-taker-name [form]="form.controls.testTakerName" />

        @for (question of test()?.questions; track question.id) {
          @switch (question.type) {
            @case ("single-choice") {
              <app-single-choice-question
                [question]="question"
                [form]="getAnswerControl(question.id)"
              />
            }
            @case ("multi-choice") {
              <app-multi-choice-question
                [question]="question"
                [form]="getAnswerControl(question.id)"
              />
            }
            @case ("text-answer") {
              <app-text-answer-question
                [question]="question"
                [form]="getAnswerControl(question.id)"
              />
            }
          }
        }
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button
        mat-button
        color="accent"
        type="submit"
        form="solved-test-form"
        [disabled]="form.invalid"
      >
        Prześlij rozwiązania
      </button>
    </mat-card-actions>
  </mat-card>
</ng-template>

<ng-container
  appPageStates
  [loadingTemplate]="loadingTemplate"
  [dataTemplate]="dataTemplate"
  [emptyTemplate]="noDataTemplate"
>
</ng-container>
